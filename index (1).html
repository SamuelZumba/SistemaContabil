<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CONTABILIDADE</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
<link rel="stylesheet" href="style.css">

</head>
<body>

<section id="loginSection" class="login-container">
<div class="login-card">
<h3 class="text-center mb-4" id="formTitle">Fazer login</h3>
<div id="alertPlaceholder"></div>

<form id="loginForm" class="mb-3">
<div class="mb-3">
<label for="loginUser" class="form-label">CPF/CNPJ para Login</label>
<input type="text" class="form-control" id="loginUser" maxlength="18" required>
</div>
<div class="mb-3">
<label for="loginPass" class="form-label">Senha</label>
<input type="password" class="form-control" id="loginPass" required>
</div>
<button type="submit" class="btn btn-primary w-100 mb-2">Entrar</button>
</form>

<form id="registerForm" class="mb-3 d-none needs-validation" novalidate>
<div class="mb-3">
<label for="registerName" class="form-label">Nome Completo</label>
<input type="text" class="form-control" id="registerName" required minlength="2">
<div class="invalid-feedback">Informe o nome.</div>
<div class="valid-feedback">Nome ok!</div>
</div>
<div class="mb-3">
<label for="registerCpf" class="form-label">CPF/CNPJ (Será usado para Login)</label>
<input type="text" class="form-control" id="registerCpf" placeholder="Digite apenas números" maxlength="18" required>
<div class="invalid-feedback" id="feedbackCpf">CPF/CNPJ inválido ou incompleto.</div>
<div class="valid-feedback">CPF/CNPJ válido e disponível.</div>
</div>
<div class="mb-3">
<label for="registerPass" class="form-label">Senha (Mín. 8 caracteres: Maiúscula, Minúscula e Símbolo)</label>
<input type="password" class="form-control" id="registerPass" required minlength="8">
<div class="invalid-feedback" id="feedbackPass">A senha deve ter no mínimo 8 caracteres e incluir: 1 Maiúscula, 1 Minúscula, 1 Número e 1 Caractere Especial.</div>
<div class="valid-feedback">Senha forte o suficiente!</div>
</div>
<div class="mb-3">
<label for="registerPassConfirm" class="form-label">Confirmar Senha</label>
<input type="password" class="form-control" id="registerPassConfirm" required>
<div class="invalid-feedback" id="feedbackPassConfirm">As senhas não coincidem.</div>
<div class="valid-feedback">Senhas coincidem!</div>
</div>

<div class="mb-3">
<label for="registerRole" class="form-label">Perfil de Usuário</label>
<select id="registerRole" class="form-select" required>
<option value="">Selecione o Perfil</option>
<option value="Admin">Administrador</option>
<option value="Colaborador">Colaborador</option>
</select>
<div class="invalid-feedback">Selecione o perfil do usuário.</div>
<div class="valid-feedback">Perfil selecionado.</div>
</div>

<button type="submit" class="btn btn-success w-100 mb-2">Cadastrar</button>
</form>

<div class="text-center small-muted">
<span id="loginToggleText">Não tem conta? </span>
<span class="link-toggle" id="toggleForm">Cadastre-se</span>
</div>
</div>
</section>

<section id="appSection" class="app-wrapper d-none">

<nav id="sidebar" class="sidebar">
<div class="sidebar-header">
<h4 class="text-white mb-0">SISTEMA CONTÁBIL</h4>
<small class="text-white-50" id="usuarioLogadoLabel">Usuário: -</small>
<small class="text-white-50 d-block" id="usuarioRoleLabel">Perfil: -</small>
</div>
<ul class="sidebar-menu" id="sidebarMenuContainer">
<li><a href="#" class="active" data-page="dashboard"><i class="fas fa-home"></i> Painel</a></li>
<li><a href="#" data-page="clientes"><i class="fas fa-users"></i> Clientes</a></li>
<li><a href="#" data-page="lancamentos"><i class="fas fa-exchange-alt"></i> Lançamentos</a></li>
<li><a href="#" data-page="relatorios"><i class="fas fa-chart-line"></i> Relatórios</a></li>
<li id="menuGestaoGeral" class="d-none"><a href="#" data-page="gestao"><i class="fas fa-tools"></i> Gestão Geral</a></li>
<li class="mt-2"><a href="#" id="btnLogout"><i class="fas fa-sign-out-alt"></i> Sair</a></li>
</ul>
</nav>

<div id="contentArea" class="content-area">

<header class="site-header">
<div class="d-flex align-items-center">
<button class="btn btn-sm btn-secondary me-3 hamburger-btn" id="toggleSidebar"><i class="fas fa-bars"></i></button>
<h3 id="pageTitle" class="mb-0"></h3>
</div>
<div class="header-controls">
<div class="form-check form-switch">
<input class="form-check-input" type="checkbox" id="toggleTheme">
<label class="form-check-label small-muted" for="toggleTheme">Modo Escuro</label>
</div>
</div>
</header>

<div id="page-dashboard" class="page-content">
<div class="card-panel">
<h5 class="mb-3"></h5>
<div class="row g-3">
<div class="col-md-12"> <div class="card text-white bg-primary">
<div class="card-body">
<h5 class="card-title"><i class="fas fa-users"></i> Clientes</h5>
<p class="card-text fs-3" id="dashClientes">0</p>
</div>
</div>
</div>
</div>

<h5 class="mt-4 mb-3">Ações Rápidas</h5>
<div class="d-flex gap-2 flex-wrap">
<button class="btn btn-success" data-page-nav="clientes"><i class="fas fa-plus"></i> Novo Cliente</button>
</div>
</div>
</div>

<div id="page-clientes" class="page-content d-none">
<div class="card-panel">
<div class="d-flex justify-content-between align-items-center mb-2">
<h5 class="mb-0">Gestão de Clientes</h5>
<div class="d-flex gap-2">
<input id="filtroClientes" class="form-control form-control-sm" placeholder="Buscar cliente..." style="min-width:180px;">
<button id="btnAddCliente" class="btn btn-primary btn-sm">Novo</button>
</div>
</div>
<form id="formClientes" class="row g-2 align-items-end d-none mb-2 needs-validation" novalidate>
  <div class="col-12 col-md-4"><label class="form-label small-muted">Nome</label><input type="text" class="form-control" id="clienteNome" required><div class="invalid-feedback">Informe o nome.</div></div>
  <div class="col-12 col-md-4"><label class="form-label small-muted">CPF/CNPJ</label><input type="text" class="form-control" id="clienteCpf" placeholder="Digite apenas números" maxlength="18" required><div class="invalid-feedback">Formato inválido.</div></div>
  <div class="col-12 col-md-4">
    <label class="form-label small-muted">Telefone</label>
    <input type="text" class="form-control" id="clienteTel" placeholder="(99) 99999-9999" maxlength="15" inputmode="tel">
  </div>
  
  <div class="col-12 d-flex justify-content-end">
    <button type="submit" class="btn btn-success btn-sm" id="btnSubmitCliente">Salvar</button>
  </div>
</form>
<div class="table-responsive">
<table class="table table-sm table-hover mb-0">
<thead class="table-light"><tr><th>Nome</th><th>CPF/CNPJ</th><th>Telefone</th><th>Ações</th></tr></thead>
<tbody id="listaClientes"></tbody>
</table>
</div>
</div>
</div>

<div id="page-gestao" class="page-content d-none">
    <div class="card-panel">
        <h5 class="mb-3">Usuários e Acessos</h5>
        <div class="d-flex justify-content-between align-items-center mb-2">
            <input id="filtroUsuarios" class="form-control form-control-sm" placeholder="Buscar usuário por nome/CPF..." style="min-width:180px; max-width: 300px;">
            <div class="d-flex gap-2">
                <button id="btnDownloadUsuariosPDF" class="btn btn-secondary btn-sm"><i class="fas fa-file-word"></i> DOC</button>
            </div>
        </div>
        <div class="table-responsive">
            <table class="table table-sm table-hover mb-0" id="tabelaUsuarios">
                <thead class="table-light"><tr><th>Nome</th><th>Login (CPF/CNPJ)</th><th>Perfil/Função</th><th>Ações</th></tr></thead>
                <tbody id="listaUsuarios"></tbody>
            </table>
        </div>
    </div>
    
    <div class="card-panel">
        <h5 class="mb-3">Gestão de Clientes e Empresas</h5>
        <div class="d-flex justify-content-between align-items-center mb-2">
            <input id="filtroClientesGestao" class="form-control form-control-sm" placeholder="Buscar cliente por nome/CPF..." style="min-width:180px; max-width: 300px;">
            <div class="d-flex gap-2">
                <button id="btnDownloadClientesGestaoPDF" class="btn btn-secondary btn-sm"><i class="fas fa-file-word"></i> DOC</button>
            </div>
        </div>
        <div class="table-responsive">
            <table class="table table-sm table-hover mb-0" id="tabelaClientesGestao">
                <thead class="table-light"><tr><th>Nome</th><th>CPF/CNPJ</th><th>Telefone</th><th>Ações</th></tr></thead>
                <tbody id="listaClientesGestao"></tbody>
            </table>
        </div>
    </div>
</div>
<div id="page-lancamentos" class="page-content d-none">
<div class="card-panel">
<h5 class="mb-2">Adicionar Lançamento Contábil</h5>

<form id="formLancamentos" class="mb-3 needs-validation" novalidate>
  
  <div class="row g-2 align-items-end mb-2">
    <div class="col-12 col-md-3">
      <label class="form-label small-muted">Nome da Conta (Ex: Estoque)</label>
      <input id="lancamentoNomeConta" class="form-control" required>
    </div>

    <div class="col-12 col-md-3">
      <label class="form-label small-muted">Tipo Contábil</label>
      <select id="lancamentoTipoConta" class="form-select" required>
              <option value="">Selecione o Tipo</option>
              <option value="Ativo Circulante">Ativo Circulante</option>
              <option value="Ativo Não Circulante">Ativo Não Circulante</option>
              <option value="Passivo Circulante">Passivo Circulante</option>
              <option value="Passivo Não Circulante">Passivo Não Circulante</option>
              <option value="Patrimônio Líquido">Patrimônio Líquido</option>
              <option value="Receita">Receita</option>
              <option value="Despesa">Despesa</option>
       </select>

    </div>
    
    <div class="col-12 col-md-3"><label class="form-label small-muted">Data</label><input id="lancData" type="date" class="form-control" required></div>
    <div class="col-12 col-md-3"><label class="form-label small-muted">Valor (R$)</label><input id="lancamentoValor" type="text" class="form-control currency-input" value="0,00" required></div>
  </div>

  <div class="row g-2 align-items-end mb-3">
    <div class="col-12 col-md-4"><label class="form-label small-muted">Cliente/Empresa</label>
      <select id="selClienteLanc" class="form-select" required><option value="">Selecione o Cliente</option></select>
    </div>

    <div class="col-12 col-md-4">
      <label class="form-label small-muted">Forma de Pagamento</label>
      <select id="selFormaPagamento" class="form-select" required>
        <option value="">Selecione a forma</option>
        <option value="À vista">À vista</option>
        <option value="À prazo (30 dias)">À prazo</option>
        <option value="Financiamento (curto)">Financiamento</option>
      </select>
    </div>

    <div class="col-12 col-md-4"><label class="form-label small-muted">Observações</label><input id="lancDesc" class="form-control"></div>
  </div>

  <div class="row">
    <div class="col-12 d-flex justify-content-end">
      <button type="submit" class="btn btn-primary btn-sm" id="btnSubmitLancamento">Adicionar Lançamento</button>
    </div>
  </div>
</form>
<div class="row g-2 align-items-end mb-3">
  <div class="col-12 col-md-6">
    <label class="form-label small-muted">Filtrar Lançamentos por Cliente</label>
    <select id="filtroClienteLancamentos" class="form-select">
      <option value="all">Mostrar Todos os Clientes</option>
    </select>
  </div>
</div>

<h5 class="mb-2">Histórico de Lançamentos <small class="small-muted">(Total: <span id="totalLancamentos">0</span>)</small></h5>
<div class="table-responsive">
<table class="table table-sm table-hover mb-0">
<thead class="table-light"><tr><th>Data</th><th>Valor</th><th>Cliente</th><th>Conta</th><th>Tipo</th><th>Pagamento</th><th>Ações</th><th>Observações</th></tr></thead>
<tbody id="listaLancamentos"></tbody>
</table>
</div>
</div>
</div>

<div id="page-relatorios" class="page-content d-none">
  <div class="card-panel mb-3">
    <h6>Filtro e Geração de Relatórios</h6>
    <div class="row g-2 mb-3 align-items-end">
      <div class="col-12 col-md-4">
        <label class="form-label small-muted">Selecione o Cliente</label>
        <select id="filtroClienteRelatorios" class="form-select">
          <option value="all"></option>
        </select>
      </div>
      <div class="col-12 col-md-8">
        <div class="d-flex gap-2 flex-wrap">
          <button id="btnDRE" class="btn btn-info">Gerar DRE</button>
          <button id="btnBalanco" class="btn btn-info">Gerar Balanço</button>
        </div>
      </div>
    </div>
    
    <div class="d-flex justify-content-between align-items-center mt-4 mb-2">
      <h6 class="mb-0">Resultado da Geração de Relatórios</h6>
      <button id="btnSalvarRelatorio" class="btn btn-sm btn-success" disabled><i class="fas fa-save"></i> Salvar Relatório</button>
    </div>
    <pre id="outputRelatorios" class="mt-1 bg-light p-3 rounded" style="white-space:pre-wrap; height:300px; overflow:auto;">Selecione um cliente e gere um relatório.</pre>
    </div>

  <div class="card-panel mb-3">
    <h6 class="mb-3">Relatórios Anexados (Arquivos)</h6>
    <div id="arquivosRelatoriosContainer">
        <h6 class="small-muted">Relatórios Salvos (<span id="nomeClienteRelatoriosArquivos">Todos os Clientes</span>):</h6>
        <ul id="listaRelatoriosArquivos" class="list-group">
            <li class="list-group-item small-muted">Nenhum relatório arquivado.</li>
        </ul>
    </div>
  </div>


  <div class="card-panel">
    <h6 class="mb-3">Anexar Arquivos ao Cliente Selecionado</h6>
    <input id="inputArquivoCliente" type="file" class="d-none" multiple />
    <button id="btnImportarArquivos" class="btn btn-sm btn-success mb-3" disabled>
      <i class="fas fa-upload"></i> Importar Arquivos (Anexar)
    </button>
    
    <div id="arquivosAnexadosContainer">
        <h6 class="small-muted">Arquivos Anexados (<span id="nomeClienteArquivos">Selecione um Cliente</span>):</h6>
        <ul id="listaArquivosCliente" class="list-group">
            <li class="list-group-item small-muted">Nenhum cliente selecionado.</li>
        </ul>
    </div>
  </div>
</div>
</div>
</section>

<div class="modal fade" id="confirmModal" tabindex="-1">
<div class="modal-dialog modal-sm modal-dialog-centered">
<div class="modal-content">
<div class="modal-body" id="confirmText"></div>
<div class="modal-footer">
<button type="button" id="confirmNo" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Não</button>
<button type="button" id="confirmYes" class="btn btn-danger btn-sm">Sim</button>
</div>
</div>
</div>
</div>

<div class="modal fade" id="detalhesClienteModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="detalhesClienteTitle">Detalhes do Cliente</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <strong>Nome:</strong> <span id="detalhesClienteNome"></span><br>
                    <strong>CPF/CNPJ:</strong> <span id="detalhesClienteCpf"></span><br>
                    <strong>Telefone:</strong> <span id="detalhesClienteTel"></span>
                </div>
                
                <hr>

                <h6>Relatórios Salvos</h6>
                <p class="small-muted">Estes são relatórios salvos apenas como texto no cadastro.</p>
                <div id="detalhesClienteRelatorios">
                    <ul class="list-group" id="listaRelatoriosTexto">
                        <li class="list-group-item small-muted">Nenhum relatório em texto salvo.</li>
                    </ul>
                </div>
                
                <div id="visualizadorRelatorioTexto" class="mt-3 d-none">
                    <h6 class="mb-2">Conteúdo do Relatório: <span id="visualizadorRelatorioTitulo"></span></h6>
                    <pre class="bg-light p-3 rounded" style="white-space:pre-wrap; max-height: 400px; overflow: auto; border: 1px solid #ccc;" id="visualizadorRelatorioConteudo"></pre>
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success btn-sm me-auto" id="btnDownloadDetalhesCliente"><i class="fas fa-download"></i> Download Completo (DOC)</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="mudarPerfilModal" tabindex="-1">
    <div class="modal-dialog modal-sm modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Alterar Perfil do Usuário</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p class="small-muted mb-2">Usuário: <strong id="usuarioMudarPerfilNome"></strong></p>  
                <label for="novaFuncaoSelect" class="form-label">Nova Função/Perfil</label>
                <select id="novaFuncaoSelect" class="form-select">
                    <option value="Admin">Administrador</option>
                    <option value="Colaborador">Colaborador</option>
                </select>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" id="btnSalvarNovaFuncao" class="btn btn-primary btn-sm">Salvar</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="script.js"></script>
</body>
</html>